<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TrueReturn - Property Investment Calculator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Söhne', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #1a1915;
      color: #e8e0d5;
      min-height: 100vh;
    }

    header {
      background: #141310;
      color: #e8e0d5;
      padding: 1.5rem 2rem;
      border-bottom: 1px solid #2a2720;
    }

    header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: -0.5px;
      color: #d4a27a;
    }

    header p {
      color: #8a8275;
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }

    /* Layout: sidebar + content */
    .app-layout {
      display: flex;
      min-height: calc(100vh - 80px);
    }

    .sidebar {
      width: 200px;
      min-width: 200px;
      background: #141310;
      border-right: 1px solid #2a2720;
      display: flex;
      flex-direction: column;
      padding: 1rem 0;
    }

    .sidebar-tab {
      display: flex;
      align-items: center;
      gap: 0.625rem;
      width: 100%;
      padding: 0.75rem 1.25rem;
      background: none;
      border: none;
      border-left: 3px solid transparent;
      color: #8a8275;
      font-family: inherit;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: color 0.2s, border-color 0.2s, background 0.2s;
      text-align: left;
    }

    .sidebar-tab:hover {
      color: #e8e0d5;
      background: rgba(212, 162, 122, 0.05);
    }

    .sidebar-tab.active {
      color: #d4a27a;
      border-left-color: #d4a27a;
      background: rgba(212, 162, 122, 0.08);
    }

    .sidebar-icon {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
    }

    .sidebar-icon svg {
      width: 18px;
      height: 18px;
      fill: none;
      stroke: currentColor;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .sidebar-shared-value {
      margin-top: auto;
      padding: 1rem 1.25rem;
      border-top: 1px solid #2a2720;
    }

    .sidebar-shared-value .shared-label {
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #6b6459;
      margin-bottom: 0.25rem;
    }

    .sidebar-shared-value .shared-amount {
      font-size: 1.125rem;
      font-weight: 700;
      color: #d4a27a;
    }

    .content-area {
      flex: 1;
      max-width: 1280px;
      margin: 2rem auto;
      padding: 0 1.5rem;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 1.5rem;
    }

    .tab-content.active.tab-placeholder-layout {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 60vh;
    }

    .tab-placeholder {
      background: #23211d;
      border-radius: 12px;
      padding: 3rem;
      border: 1px solid #2e2b26;
      text-align: center;
      max-width: 480px;
      width: 100%;
    }

    .tab-placeholder h2 {
      font-size: 1.25rem;
      color: #e8e0d5;
      margin-bottom: 0.75rem;
    }

    .tab-placeholder p {
      color: #8a8275;
      font-size: 0.9375rem;
      line-height: 1.6;
      margin-bottom: 0.5rem;
    }

    .tab-placeholder .placeholder-amount {
      font-size: 1.5rem;
      font-weight: 700;
      color: #d4a27a;
      margin-top: 1rem;
    }

    .card.full-width {
      grid-column: 1 / -1;
    }

    .projections-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }

    .card {
      background: #23211d;
      border-radius: 12px;
      padding: 2rem;
      border: 1px solid #2e2b26;
    }

    .card h2 {
      font-size: 1.125rem;
      margin-bottom: 1.5rem;
      color: #e8e0d5;
    }

    .form-group {
      margin-bottom: 1.25rem;
    }

    label {
      display: block;
      font-size: 0.8125rem;
      font-weight: 500;
      color: #8a8275;
      margin-bottom: 0.375rem;
    }

    .input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }

    .input-wrapper .prefix,
    .input-wrapper .suffix {
      position: absolute;
      color: #6b6459;
      font-size: 0.875rem;
      pointer-events: none;
    }

    .input-wrapper .prefix {
      left: 12px;
    }

    .input-wrapper .suffix {
      right: 12px;
    }

    input[type="number"] {
      width: 100%;
      padding: 0.625rem 0.75rem;
      border: 1px solid #3a3730;
      border-radius: 8px;
      font-size: 0.9375rem;
      transition: border-color 0.2s;
      -moz-appearance: textfield;
      background: #1a1915;
      color: #e8e0d5;
    }

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
    }

    input[type="number"]:focus {
      outline: none;
      border-color: #d4a27a;
      box-shadow: 0 0 0 3px rgba(212, 162, 122, 0.15);
    }

    select {
      width: 100%;
      padding: 0.625rem 0.75rem;
      border: 1px solid #3a3730;
      border-radius: 8px;
      font-size: 0.9375rem;
      transition: border-color 0.2s;
      background: #1a1915;
      color: #e8e0d5;
      cursor: pointer;
    }

    select:focus {
      outline: none;
      border-color: #d4a27a;
      box-shadow: 0 0 0 3px rgba(212, 162, 122, 0.15);
    }

    select option {
      background: #23211d;
      color: #e8e0d5;
    }

    .computed-display {
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
      margin-top: 0.375rem;
    }

    .computed-value {
      font-size: 1rem;
      font-weight: 600;
      color: #d4a27a;
    }

    .computed-note {
      font-size: 0.75rem;
      color: #6b6459;
    }

    .input-section-header {
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0.75rem 0 0.5rem;
      margin-top: 1.25rem;
      margin-bottom: 0.75rem;
      border-bottom: 1px solid #2e2b26;
    }

    .input-section-header:first-of-type {
      margin-top: 0;
    }

    .input-section-header.purchase {
      color: #d4a27a;
    }

    .input-section-header.expenses-input {
      color: #e87c6c;
    }

    .input-section-header.income-input {
      color: #6bc985;
    }

    .has-prefix input {
      padding-left: 1.75rem;
    }

    .has-suffix input {
      padding-right: 2.25rem;
    }

    .results-card {
      align-self: start;
    }

    .results-card-standalone {
      align-self: start;
    }

    .section-header {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0.75rem 0 0.5rem;
      margin-top: 0.75rem;
      border-bottom: 2px solid #2e2b26;
    }

    .section-header:first-of-type {
      margin-top: 0;
    }

    .section-header.income {
      color: #6bc985;
      border-color: #2d4a35;
    }

    .section-header.startup {
      color: #d4a27a;
      border-color: #4a3a2d;
    }

    .section-header.monthly {
      color: #7cacf0;
      border-color: #2d3a4a;
    }

    .section-header.expenses {
      color: #e87c6c;
      border-color: #4a2d2d;
    }

    .section-header.taxbenefit {
      color: #6bc985;
      border-color: #2d4a35;
    }

    .section-header.results-heading {
      color: #d4a27a;
      border-color: #4a3a2d;
    }

    .section-header.projection {
      color: #7cacf0;
      border-color: #2d3a4a;
    }

    .section-header.cashflow {
      color: #6bc985;
      border-color: #2d4a35;
    }

    .section-header.cashout {
      color: #c9a6e8;
      border-color: #3d2d4a;
    }

    .section-header.performance {
      color: #d4c97a;
      border-color: #4a462d;
    }

    .section-header.offset {
      color: #e0c068;
      border-color: #4a3f2d;
    }

    .toggle-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.375rem;
    }

    .toggle-row input[type="checkbox"] {
      accent-color: #d4a27a;
      width: 14px;
      height: 14px;
      cursor: pointer;
    }

    .toggle-row label {
      font-size: 0.75rem;
      color: #6b6459;
      margin-bottom: 0;
      cursor: pointer;
    }

    input[type="number"]:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .tab-content.active.two-col-layout {
      grid-template-columns: 1fr 1fr;
    }


    .line-item.muted .line-label {
      color: #6b6459;
    }

    .line-item.muted .line-value {
      color: #8a8275;
    }

    .line-item {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      padding: 0.5rem 0;
      border-bottom: 1px solid #2a2720;
    }

    .line-item:last-child {
      border-bottom: none;
    }

    .line-label {
      font-size: 0.8125rem;
      color: #8a8275;
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }

    .help-tip {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      border: 1px solid #3a3730;
      font-size: 0.625rem;
      font-weight: 600;
      color: #6b6459;
      cursor: help;
      position: relative;
      flex-shrink: 0;
    }

    .help-tip:hover {
      border-color: #d4a27a;
      color: #d4a27a;
    }

    .help-tip:hover::after {
      content: attr(data-tip);
      position: absolute;
      bottom: calc(100% + 6px);
      left: 50%;
      transform: translateX(-50%);
      background: #141310;
      color: #e8e0d5;
      font-size: 0.6875rem;
      font-weight: 400;
      padding: 0.375rem 0.625rem;
      border-radius: 6px;
      border: 1px solid #3a3730;
      white-space: nowrap;
      z-index: 10;
    }

    .line-value {
      font-size: 0.9375rem;
      font-weight: 600;
      color: #e8e0d5;
    }

    .line-value.positive {
      color: #6bc985;
    }

    .line-value.negative {
      color: #e87c6c;
    }

    .line-item.total {
      border-top: 1px solid #3a3730;
      border-bottom: none;
      padding-top: 0.625rem;
      margin-top: 0.25rem;
    }

    .line-item.total .line-label {
      font-weight: 600;
      color: #e8e0d5;
    }

    .line-item.total .line-value {
      font-size: 1.0625rem;
    }

    .result-item {
      padding: 1rem 0;
      border-bottom: 1px solid #2a2720;
    }

    .result-item:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    .result-label {
      font-size: 0.8125rem;
      color: #6b6459;
      margin-bottom: 0.25rem;
    }

    .result-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: #e8e0d5;
    }

    .result-value.positive {
      color: #6bc985;
    }

    .result-value.negative {
      color: #e87c6c;
    }

    .result-sub {
      font-size: 0.75rem;
      color: #6b6459;
      margin-top: 0.25rem;
    }

    @media (max-width: 900px) {
      .app-layout {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        min-width: 0;
        flex-direction: row;
        overflow-x: auto;
        padding: 0;
        border-right: none;
        border-bottom: 1px solid #2a2720;
      }

      .sidebar-tab {
        border-left: none;
        border-bottom: 3px solid transparent;
        padding: 0.75rem 1rem;
        white-space: nowrap;
        flex-shrink: 0;
      }

      .sidebar-tab.active {
        border-left-color: transparent;
        border-bottom-color: #d4a27a;
      }

      .sidebar-shared-value {
        margin-top: 0;
        margin-left: auto;
        border-top: none;
        border-left: 1px solid #2a2720;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        flex-shrink: 0;
      }

      .sidebar-shared-value .shared-label {
        margin-bottom: 0;
      }

      .tab-content.active {
        grid-template-columns: 1fr;
      }

      .tab-content.active.two-col-layout {
        grid-template-columns: 1fr;
      }


      .projections-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>TrueReturn</h1>
    <p>Property Investment Calculator</p>
  </header>

  <div class="app-layout">
    <nav class="sidebar">
      <button class="sidebar-tab active" data-tab="tab-property">
        <span class="sidebar-icon"><svg viewBox="0 0 24 24"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-4 0a1 1 0 01-1-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 01-1 1h-2z"/></svg></span>
        Property
      </button>
      <button class="sidebar-tab" data-tab="tab-offset">
        <span class="sidebar-icon"><svg viewBox="0 0 24 24"><path d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg></span>
        Offset
      </button>
      <button class="sidebar-tab" data-tab="tab-stocks">
        <span class="sidebar-icon"><svg viewBox="0 0 24 24"><path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg></span>
        Stocks / ETFs
      </button>
      <button class="sidebar-tab" data-tab="tab-compare">
        <span class="sidebar-icon"><svg viewBox="0 0 24 24"><path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg></span>
        Compare
      </button>
      <div class="sidebar-shared-value">
        <div class="shared-label">Total Upfront</div>
        <div class="shared-amount" id="sidebarUpfront">-</div>
        <div class="shared-label" style="margin-top: 0.5rem;">Interest Rate</div>
        <div class="shared-amount" id="sidebarRate">-</div>
      </div>
    </nav>

    <main class="content-area">
      <section id="tab-property" class="tab-content active">
        <div class="card">
      <h2>Property Details</h2>

      <!-- Purchase section -->
      <div class="input-section-header purchase">Purchase</div>

      <div class="form-group">
        <label for="purchasePrice">Purchase Price</label>
        <div class="input-wrapper has-prefix">
          <span class="prefix">$</span>
          <input type="number" id="purchasePrice" value="295000" min="0" step="1000">
        </div>
      </div>

      <div class="form-group">
        <label for="depositPct">Deposit</label>
        <div class="input-wrapper has-suffix">
          <input type="number" id="depositPct" value="20" min="0" max="100" step="1">
          <span class="suffix">%</span>
        </div>
      </div>

      <div class="form-group">
        <label for="loanType">Loan Type</label>
        <select id="loanType">
          <option value="IO">Interest Only</option>
          <option value="PI" selected>Principal & Interest</option>
        </select>
      </div>

      <div class="form-group" id="loanTermGroup">
        <label for="loanTerm">Loan Term</label>
        <div class="input-wrapper has-suffix">
          <input type="number" id="loanTerm" value="30" min="1" max="40" step="1">
          <span class="suffix">yrs</span>
        </div>
      </div>

      <div class="form-group">
        <label for="state">State</label>
        <select id="state">
          <option value="NSW">New South Wales</option>
          <option value="VIC">Victoria</option>
          <option value="QLD" selected>Queensland</option>
          <option value="SA">South Australia</option>
          <option value="WA">Western Australia</option>
          <option value="TAS">Tasmania</option>
          <option value="ACT">Australian Capital Territory</option>
          <option value="NT">Northern Territory</option>
        </select>
        <div class="computed-display">
          <span class="help-tip" data-tip="Populates values based on state averages">?</span>
          <span class="computed-note">Populates values based on state averages</span>
        </div>
      </div>

      <div class="form-group">
        <label for="interestRate">Interest Rate</label>
        <div class="input-wrapper has-suffix">
          <input type="number" id="interestRate" value="5.89" min="0" max="20" step="0.01">
          <span class="suffix">%</span>
        </div>
      </div>

      <!-- Expenses section -->
      <div class="input-section-header expenses-input">Expenses</div>

      <div class="form-group">
        <label for="managementFee">Property Management Fee</label>
        <div class="input-wrapper has-suffix">
          <input type="number" id="managementFee" value="6.6" min="0" max="100" step="0.1">
          <span class="suffix">%</span>
        </div>
      </div>

      <!-- Income section -->
      <div class="input-section-header income-input">Income</div>

      <div class="form-group">
        <label for="weeklyRent">Expected Weekly Rent</label>
        <div class="input-wrapper has-prefix">
          <span class="prefix">$</span>
          <input type="number" id="weeklyRent" value="420" min="0" step="10">
        </div>
      </div>
    </div>

    <div class="card results-card">
      <h2>Breakdown</h2>

      <!-- Income -->
      <div class="section-header income">Income</div>
      <div class="line-item">
        <span class="line-label">Weekly Rent</span>
        <span class="line-value" id="resWeeklyRent">-</span>
      </div>
      <div class="line-item total">
        <span class="line-label">Annual Rent</span>
        <span class="line-value" id="resAnnualRent">-</span>
      </div>

      <!-- Start Up Expenses -->
      <div class="section-header startup">Start Up Expenses</div>
      <div class="line-item">
        <span class="line-label">Deposit</span>
        <span class="line-value" id="resDeposit">-</span>
      </div>
      <div class="line-item">
        <span class="line-label">Stamp Duty <span class="help-tip" data-tip="Based on state selected">?</span></span>
        <span class="line-value" id="resStampDuty">-</span>
      </div>
      <div class="line-item">
        <span class="line-label">Conveyancing <span class="help-tip" data-tip="Based on averages for state selected">?</span></span>
        <span class="line-value" id="resConveyancing">-</span>
      </div>
      <div class="line-item total">
        <span class="line-label">Total Upfront</span>
        <span class="line-value" id="resTotalUpfront">-</span>
      </div>

      <!-- Month-to-Month Picture -->
      <div class="section-header monthly">Month-to-Month Picture</div>
      <div class="line-item">
        <span class="line-label">Rent In</span>
        <span class="line-value positive" id="resMonthlyRent">-</span>
      </div>
      <div class="line-item">
        <span class="line-label">Property Management</span>
        <span class="line-value" id="resMonthlyMgmt">-</span>
      </div>
      <div class="line-item">
        <span class="line-label">Loan Payment</span>
        <span class="line-value" id="resMonthlyLoan">-</span>
      </div>
      <div class="line-item total">
        <span class="line-label">Monthly Cash Flow</span>
        <span class="line-value" id="resMonthlyCashFlow">-</span>
      </div>

      <!-- Annual Expenses -->
      <div class="section-header expenses">Annual Expenses</div>
      <div class="line-item">
        <span class="line-label">Loan Payment</span>
        <span class="line-value" id="resLoanPayment">-</span>
      </div>
      <div id="loanBreakdown" style="display: flex; flex-direction: column; align-items: flex-end; margin-top: -0.25rem; margin-bottom: 0.25rem;">
        <span class="computed-note" id="resPrincipalPortion">-</span>
        <span class="computed-note" id="resInterestPortion">-</span>
      </div>
      <div class="line-item">
        <span class="line-label">Property Management</span>
        <span class="line-value" id="resManagement">-</span>
      </div>
      <div class="line-item">
        <span class="line-label">Insurance <span class="help-tip" data-tip="Based on averages for state selected">?</span></span>
        <span class="line-value" id="resInsurance">-</span>
      </div>
      <div class="line-item">
        <span class="line-label">Council Rates</span>
        <span class="line-value" id="resCouncil">-</span>
      </div>
      <div class="line-item">
        <span class="line-label">Vacancy Allowance <span class="help-tip" data-tip="Assumed 2 weeks per year">?</span></span>
        <span class="line-value" id="resVacancy">-</span>
      </div>
      <div class="line-item">
        <span class="line-label">Maintenance Allowance <span class="help-tip" data-tip="Estimated at 0.5% of property value">?</span></span>
        <span class="line-value" id="resMaintenance">-</span>
      </div>
      <div class="line-item total">
        <span class="line-label">Total Annual Expenses</span>
        <span class="line-value" id="resTotalExpenses">-</span>
      </div>

      <!-- Tax Benefit -->
      <div class="section-header taxbenefit">Potential Tax Benefit</div>
      <div class="line-item muted">
        <span class="line-label">Deductible Expenses</span>
        <span class="line-value" id="resDeductible">-</span>
      </div>
      <div class="line-item muted">
        <span class="line-label">Net Rental Position</span>
        <span class="line-value" id="resNetRental">-</span>
      </div>
      <div class="line-item">
        <span class="line-label">Est. Tax Benefit <span class="help-tip" data-tip="Assumed 30% marginal tax rate. Actual rate depends on your taxable income.">?</span></span>
        <span class="line-value positive" id="resTaxBenefit">-</span>
      </div>
      <div class="computed-note" style="margin-top: 0.5rem; line-height: 1.4;">Deductible expenses include loan interest, property management, insurance, council rates, and maintenance. If these exceed rental income, the loss can be offset against your other taxable income (negative gearing). The benefit is estimated at 30% of the rental loss. Does not include depreciation. Note: potential tax benefit is not included in Annual Cash Flow as it depends heavily on your individual tax situation.</div>
    </div>

    <div class="card results-card-standalone">
      <h2>Results</h2>

      <div class="result-item">
        <div class="result-label">Annual Cash Flow</div>
        <div class="result-value" id="annualCashFlow">-</div>
        <div class="result-sub" id="monthlyCashFlow"></div>
      </div>

      <div class="result-item">
        <div class="result-label">Gross Yield</div>
        <div class="result-value" id="grossYield">-</div>
        <div class="result-sub">Annual rent / purchase price</div>
        <div class="computed-note" style="margin-top: 0.5rem; line-height: 1.4;">A gross rental yield of 5% or higher is often considered strong for residential property. Capital city yields commonly sit around 3–5%, while regional properties may achieve 5–8% or more. Yields below 4% may suggest the property is priced for growth rather than income.</div>
      </div>

      <div class="result-item">
        <div class="result-label">Net Yield</div>
        <div class="result-value" id="netYield">-</div>
        <div class="result-sub">After all expenses</div>
        <div class="computed-note" style="margin-top: 0.5rem; line-height: 1.4;">Net yield measures rental return after costs and is a more realistic indicator of cash flow than gross yield.</div>
      </div>

      <div class="result-item">
        <div class="result-label">Cash on Cash Return</div>
        <div class="result-value" id="cashOnCash">-</div>
        <div class="result-sub">Annual cash flow / total cash invested</div>
      </div>
    </div>

    <div class="card full-width">
      <h2>Projections</h2>

      <div class="form-group" style="max-width: 460px;">
        <label for="expectedGrowth">Expected Annual Growth</label>
        <div class="input-wrapper has-suffix" style="max-width: 260px;">
          <input type="number" id="expectedGrowth" value="3" min="-20" max="50" step="0.5">
          <span class="suffix">%</span>
        </div>
        <div class="computed-note" style="margin-top: 0.5rem; line-height: 1.4;">Australian residential property prices have grown at approximately 6–7% per year over the past 20 years, but returns vary significantly by location and market cycle. Past performance does not guarantee future results.</div>
      </div>

      <div class="projections-grid">
        <!-- 5 Year -->
        <div>
          <div class="section-header projection">5 Year</div>
          <div class="line-item">
            <span class="line-label">Property Value</span>
            <span class="line-value" id="proj5Value">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">Capital Growth</span>
            <span class="line-value" id="proj5Growth">-</span>
          </div>
          <div class="line-item muted">
            <span class="line-label">Principal Paid Down</span>
            <span class="line-value" id="proj5Principal">-</span>
          </div>
          <div class="line-item muted">
            <span class="line-label">Remaining Loan</span>
            <span class="line-value" id="proj5Loan">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">Equity</span>
            <span class="line-value" id="proj5Equity">-</span>
          </div>

          <div class="section-header cashflow">Cash Flow</div>
          <div class="line-item">
            <span class="line-label">Est. Weekly Rent <span class="help-tip" data-tip="Rent increases in line with property value growth">?</span></span>
            <span class="line-value" id="proj5Rent">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">Est. Annual Cash Flow</span>
            <span class="line-value" id="proj5CashFlow">-</span>
          </div>

          <div class="section-header cashout">Cash Out Position</div>
          <div class="line-item">
            <span class="line-label">Sale Price</span>
            <span class="line-value" id="proj5Sale">-</span>
          </div>
          <div class="line-item muted">
            <span class="line-label">Sales Costs <span class="help-tip" data-tip="Estimated at 3% of sale price (agent fees, legal, marketing)">?</span></span>
            <span class="line-value" id="proj5SaleCosts">-</span>
          </div>
          <div class="line-item muted">
            <span class="line-label">Remaining Loan Payout</span>
            <span class="line-value" id="proj5LoanPayout">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">Net Proceeds Before Tax</span>
            <span class="line-value" id="proj5NetProceeds">-</span>
          </div>
          <div class="line-item muted">
            <span class="line-label">Capital Gains Tax <span class="help-tip" data-tip="50% CGT discount applied. Assumed 30% marginal tax rate based on median Australian salary. Actual rate depends on your taxable income.">?</span></span>
            <span class="line-value" id="proj5CGT">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">True Cash Return</span>
            <span class="line-value" id="proj5TrueReturn">-</span>
          </div>

          <div class="section-header performance">Investment Performance</div>
          <div class="line-item muted">
            <span class="line-label">Total Cash Invested <span class="help-tip" data-tip="Deposit + stamp duty + conveyancing">?</span></span>
            <span class="line-value" id="proj5CashInvested">-</span>
          </div>
          <div class="line-item muted">
            <span class="line-label">Cumulative Cash Flow <span class="help-tip" data-tip="Total rent income minus expenses over the period">?</span></span>
            <span class="line-value" id="proj5CumCashFlow">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">Total Profit <span class="help-tip" data-tip="True cash return minus cash invested, plus cumulative cash flow">?</span></span>
            <span class="line-value" id="proj5TotalProfit">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">Total Return on Cash <span class="help-tip" data-tip="Total profit as a percentage of cash invested">?</span></span>
            <span class="line-value" id="proj5ReturnOnCash">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">Annualised Return <span class="help-tip" data-tip="Equivalent annual return rate — compare against shares or index funds">?</span></span>
            <span class="line-value" id="proj5AnnualisedReturn">-</span>
          </div>
        </div>

        <!-- 10 Year -->
        <div>
          <div class="section-header projection">10 Year</div>
          <div class="line-item">
            <span class="line-label">Property Value</span>
            <span class="line-value" id="proj10Value">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">Capital Growth</span>
            <span class="line-value" id="proj10Growth">-</span>
          </div>
          <div class="line-item muted">
            <span class="line-label">Principal Paid Down</span>
            <span class="line-value" id="proj10Principal">-</span>
          </div>
          <div class="line-item muted">
            <span class="line-label">Remaining Loan</span>
            <span class="line-value" id="proj10Loan">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">Equity</span>
            <span class="line-value" id="proj10Equity">-</span>
          </div>

          <div class="section-header cashflow">Cash Flow</div>
          <div class="line-item">
            <span class="line-label">Est. Weekly Rent <span class="help-tip" data-tip="Rent increases in line with property value growth">?</span></span>
            <span class="line-value" id="proj10Rent">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">Est. Annual Cash Flow</span>
            <span class="line-value" id="proj10CashFlow">-</span>
          </div>

          <div class="section-header cashout">Cash Out Position</div>
          <div class="line-item">
            <span class="line-label">Sale Price</span>
            <span class="line-value" id="proj10Sale">-</span>
          </div>
          <div class="line-item muted">
            <span class="line-label">Sales Costs <span class="help-tip" data-tip="Estimated at 3% of sale price (agent fees, legal, marketing)">?</span></span>
            <span class="line-value" id="proj10SaleCosts">-</span>
          </div>
          <div class="line-item muted">
            <span class="line-label">Remaining Loan Payout</span>
            <span class="line-value" id="proj10LoanPayout">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">Net Proceeds Before Tax</span>
            <span class="line-value" id="proj10NetProceeds">-</span>
          </div>
          <div class="line-item muted">
            <span class="line-label">Capital Gains Tax <span class="help-tip" data-tip="50% CGT discount applied. Assumed 30% marginal tax rate based on median Australian salary. Actual rate depends on your taxable income.">?</span></span>
            <span class="line-value" id="proj10CGT">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">True Cash Return</span>
            <span class="line-value" id="proj10TrueReturn">-</span>
          </div>

          <div class="section-header performance">Investment Performance</div>
          <div class="line-item muted">
            <span class="line-label">Total Cash Invested <span class="help-tip" data-tip="Deposit + stamp duty + conveyancing">?</span></span>
            <span class="line-value" id="proj10CashInvested">-</span>
          </div>
          <div class="line-item muted">
            <span class="line-label">Cumulative Cash Flow <span class="help-tip" data-tip="Total rent income minus expenses over the period">?</span></span>
            <span class="line-value" id="proj10CumCashFlow">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">Total Profit <span class="help-tip" data-tip="True cash return minus cash invested, plus cumulative cash flow">?</span></span>
            <span class="line-value" id="proj10TotalProfit">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">Total Return on Cash <span class="help-tip" data-tip="Total profit as a percentage of cash invested">?</span></span>
            <span class="line-value" id="proj10ReturnOnCash">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">Annualised Return <span class="help-tip" data-tip="Equivalent annual return rate — compare against shares or index funds">?</span></span>
            <span class="line-value" id="proj10AnnualisedReturn">-</span>
          </div>
        </div>
      </div>
        </div>
      </section>

      <section id="tab-offset" class="tab-content two-col-layout">
        <div class="card">
          <h2>Offset Details</h2>

          <div class="form-group">
            <label for="offsetAmount">Offset Amount</label>
            <div class="input-wrapper has-prefix">
              <span class="prefix">$</span>
              <input type="number" id="offsetAmount" value="69900" min="0" step="1000">
            </div>
            <div class="toggle-row">
              <input type="checkbox" id="usePropertyUpfront" checked>
              <label for="usePropertyUpfront">Use Property Total Upfront</label>
            </div>
          </div>

          <div class="form-group">
            <label for="offsetLoanBalance">Loan Balance</label>
            <div class="input-wrapper has-prefix">
              <span class="prefix">$</span>
              <input type="number" id="offsetLoanBalance" value="600000" min="0" step="1000">
            </div>
          </div>

          <div class="form-group">
            <label for="offsetInterestRate">Interest Rate</label>
            <div class="input-wrapper has-suffix">
              <input type="number" id="offsetInterestRate" value="5.89" min="0" max="20" step="0.01">
              <span class="suffix">%</span>
            </div>
            <div class="toggle-row">
              <input type="checkbox" id="usePropertyRate" checked>
              <label for="usePropertyRate">Use Property Rate</label>
            </div>
          </div>

          <div class="form-group">
            <label for="offsetLoanType">Loan Type</label>
            <select id="offsetLoanType">
              <option value="IO">Interest Only</option>
              <option value="PI" selected>Principal & Interest</option>
            </select>
          </div>

          <div class="form-group" id="offsetLoanTermGroup">
            <label for="offsetLoanTerm">Loan Term</label>
            <div class="input-wrapper has-suffix">
              <input type="number" id="offsetLoanTerm" value="30" min="1" max="40" step="1">
              <span class="suffix">yrs</span>
            </div>
          </div>
        </div>

        <div class="card results-card">
          <h2>Interest Saved</h2>

          <div class="result-item">
            <div class="result-label">Effective Return</div>
            <div class="result-value positive" id="offsetEffectiveReturn">-</div>
            <div class="computed-note" style="margin-top: 0.375rem; line-height: 1.4;">Every dollar in an offset account saves you the loan interest rate in interest, tax-free. This is equivalent to earning the rate in a savings account before tax.</div>
          </div>

          <div class="line-item" id="offsetTimeSavedRow">
            <span class="line-label">Time Saved on Loan <span class="help-tip" data-tip="How much sooner the loan is fully paid off with the offset (P&I only)">?</span></span>
            <span class="line-value positive" id="offsetTimeSaved">-</span>
          </div>

          <div class="section-header offset">5 Year</div>
          <div class="line-item">
            <span class="line-label">Without Offset</span>
            <span class="line-value" id="offsetNoOffset5">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">With Offset</span>
            <span class="line-value" id="offsetWithOffset5">-</span>
          </div>
          <div class="line-item total">
            <span class="line-label">Interest Saved</span>
            <span class="line-value positive" id="offsetSaved5">-</span>
          </div>

          <div class="section-header offset">10 Year</div>
          <div class="line-item">
            <span class="line-label">Without Offset</span>
            <span class="line-value" id="offsetNoOffset10">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">With Offset</span>
            <span class="line-value" id="offsetWithOffset10">-</span>
          </div>
          <div class="line-item total">
            <span class="line-label">Interest Saved</span>
            <span class="line-value positive" id="offsetSaved10">-</span>
          </div>

          <div class="section-header offset">Lifetime of Loan</div>
          <div class="line-item">
            <span class="line-label">Without Offset</span>
            <span class="line-value" id="offsetNoOffsetLife">-</span>
          </div>
          <div class="line-item">
            <span class="line-label">With Offset</span>
            <span class="line-value" id="offsetWithOffsetLife">-</span>
          </div>
          <div class="line-item total">
            <span class="line-label">Interest Saved</span>
            <span class="line-value positive" id="offsetSavedLifetime">-</span>
          </div>
        </div>
      </section>

      <section id="tab-stocks" class="tab-content tab-placeholder-layout">
        <div class="tab-placeholder">
          <h2>Stocks / Shares / ETFs</h2>
          <p>Compare what the same upfront investment could return in the share market over the same period.</p>
          <p>Using your Property investment amount:</p>
          <div class="placeholder-amount" id="placeholderStocksAmount">-</div>
        </div>
      </section>

      <section id="tab-compare" class="tab-content tab-placeholder-layout">
        <div class="tab-placeholder">
          <h2>Compare Investments</h2>
          <p>Side-by-side comparison of property vs offset vs stocks using the same starting capital.</p>
          <p>Using your Property investment amount:</p>
          <div class="placeholder-amount" id="placeholderCompareAmount">-</div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // Shared state
    window.TrueReturn = { totalUpfront: 0, interestRate: 0 };

    // Tab switching
    function initTabs() {
      const tabs = document.querySelectorAll('.sidebar-tab');
      const sections = document.querySelectorAll('.tab-content');
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          tabs.forEach(t => t.classList.remove('active'));
          sections.forEach(s => s.classList.remove('active'));
          tab.classList.add('active');
          document.getElementById(tab.dataset.tab).classList.add('active');
        });
      });
    }
    initTabs();

    function updateSharedUpfront(amount, rate) {
      window.TrueReturn.totalUpfront = amount;
      window.TrueReturn.interestRate = rate;
      const formatted = formatCurrency(amount);
      document.getElementById('sidebarUpfront').textContent = formatted;
      document.getElementById('sidebarRate').textContent = rate.toFixed(2) + '%';
      document.getElementById('placeholderStocksAmount').textContent = formatted;
      document.getElementById('placeholderCompareAmount').textContent = formatted;

      // Sync to offset tab if toggles are checked
      if (document.getElementById('usePropertyUpfront').checked) {
        document.getElementById('offsetAmount').value = Math.round(amount);
      }
      if (document.getElementById('usePropertyRate').checked) {
        document.getElementById('offsetInterestRate').value = rate;
      }
      calculateOffset();
    }

    const inputs = document.querySelectorAll('#tab-property input[type="number"]');
    const stateSelect = document.getElementById('state');
    const loanTypeSelect = document.getElementById('loanType');
    const loanTermGroup = document.getElementById('loanTermGroup');

    // Show/hide loan term based on loan type
    loanTypeSelect.addEventListener('change', function() {
      loanTermGroup.style.display = this.value === 'PI' ? '' : 'none';
      calculate();
    });

    function getVal(id) {
      return parseFloat(document.getElementById(id).value) || 0;
    }

    function formatCurrency(amount) {
      const abs = Math.abs(amount);
      const formatted = abs >= 1000
        ? '$' + abs.toLocaleString('en-AU', { minimumFractionDigits: 0, maximumFractionDigits: 0 })
        : '$' + abs.toFixed(0);
      return amount < 0 ? '-' + formatted : formatted;
    }

    // State-based average estimates (annual)
    const stateDefaults = {
      NSW: { conveyancing: 1800, insurance: 1800, council: 2000 },
      VIC: { conveyancing: 1100, insurance: 1500, council: 1900 },
      QLD: { conveyancing: 900,  insurance: 2200, council: 1800 },
      SA:  { conveyancing: 1000, insurance: 1300, council: 1600 },
      WA:  { conveyancing: 1300, insurance: 1500, council: 1800 },
      TAS: { conveyancing: 1000, insurance: 1200, council: 1400 },
      ACT: { conveyancing: 1100, insurance: 1300, council: 2100 },
      NT:  { conveyancing: 1000, insurance: 2500, council: 1700 },
    };

    // Stamp duty calculators by state (general/investor rates, not FHB)
    function calcStampDuty(state, price) {
      if (price <= 0) return 0;

      switch (state) {
        case 'NSW':
          if (price <= 14000) return price * 0.0125;
          if (price <= 31000) return 175 + (price - 14000) * 0.015;
          if (price <= 83000) return 430 + (price - 31000) * 0.0175;
          if (price <= 313000) return 1340 + (price - 83000) * 0.035;
          if (price <= 1043000) return 9390 + (price - 313000) * 0.045;
          if (price <= 3721000) return 42240 + (price - 1043000) * 0.055;
          return price * 0.07;

        case 'VIC':
          if (price <= 25000) return price * 0.014;
          if (price <= 130000) return 350 + (price - 25000) * 0.024;
          if (price <= 960000) return 2870 + (price - 130000) * 0.06;
          if (price <= 2000000) return price * 0.055;
          return 110000 + (price - 2000000) * 0.065;

        case 'QLD':
          if (price <= 5000) return 0;
          if (price <= 75000) return (price - 5000) * 0.015;
          if (price <= 540000) return 1050 + (price - 75000) * 0.035;
          if (price <= 1000000) return 17325 + (price - 540000) * 0.045;
          return 38025 + (price - 1000000) * 0.0575;

        case 'SA':
          if (price <= 12000) return price * 0.01;
          if (price <= 30000) return 120 + (price - 12000) * 0.02;
          if (price <= 50000) return 480 + (price - 30000) * 0.03;
          if (price <= 100000) return 1080 + (price - 50000) * 0.035;
          if (price <= 200000) return 2830 + (price - 100000) * 0.04;
          if (price <= 250000) return 6830 + (price - 200000) * 0.0425;
          if (price <= 300000) return 8955 + (price - 250000) * 0.0475;
          if (price <= 500000) return 11330 + (price - 300000) * 0.05;
          return 21330 + (price - 500000) * 0.055;

        case 'WA':
          if (price <= 120000) return price * 0.019;
          if (price <= 150000) return 2280 + (price - 120000) * 0.0285;
          if (price <= 360000) return 3135 + (price - 150000) * 0.038;
          if (price <= 725000) return 11115 + (price - 360000) * 0.0475;
          return 28453 + (price - 725000) * 0.0515;

        case 'TAS':
          if (price <= 3000) return 50;
          if (price <= 25000) return 50 + (price - 3000) * 0.0175;
          if (price <= 75000) return 435 + (price - 25000) * 0.0225;
          if (price <= 200000) return 1560 + (price - 75000) * 0.035;
          if (price <= 375000) return 5935 + (price - 200000) * 0.04;
          if (price <= 725000) return 12935 + (price - 375000) * 0.0425;
          return 27810 + (price - 725000) * 0.045;

        case 'ACT':
          if (price <= 260000) return price * 0.0049;
          if (price <= 300000) return 1040 + (price - 260000) * 0.022;
          if (price <= 500000) return 1920 + (price - 300000) * 0.034;
          if (price <= 750000) return 8720 + (price - 500000) * 0.0432;
          if (price <= 1000000) return 19520 + (price - 750000) * 0.059;
          if (price <= 1455000) return 34270 + (price - 1000000) * 0.064;
          return price * 0.0454;

        case 'NT':
          if (price <= 525000) {
            const v = price / 1000;
            return (0.06571441 * v * v + 15 * v);
          }
          if (price <= 3000000) return price * 0.0495;
          if (price <= 5000000) return price * 0.0575;
          return price * 0.0595;

        default:
          return 0;
      }
    }

    function calculate() {
      const purchasePrice = getVal('purchasePrice');
      const depositPct = getVal('depositPct') / 100;
      const state = stateSelect.value;
      const defaults = stateDefaults[state];
      const stampDuty = Math.round(calcStampDuty(state, purchasePrice));
      const loanType = loanTypeSelect.value;
      const loanTerm = getVal('loanTerm');
      const interestRate = getVal('interestRate') / 100;
      const weeklyRent = getVal('weeklyRent');
      const managementFeePct = getVal('managementFee') / 100;
      const expectedGrowth = getVal('expectedGrowth') / 100;

      // State-based values
      const conveyancing = defaults.conveyancing;
      const insurance = defaults.insurance;
      const councilFees = defaults.council;

      // Core figures
      const deposit = purchasePrice * depositPct;
      const loanAmount = purchasePrice - deposit;

      // Loan payment calculation
      let annualLoanPayment;
      if (loanType === 'IO' || interestRate === 0) {
        annualLoanPayment = loanAmount * interestRate;
      } else {
        // P&I: M = P * [r(1+r)^n] / [(1+r)^n - 1]
        const monthlyRate = interestRate / 12;
        const numPayments = loanTerm * 12;
        const monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1);
        annualLoanPayment = monthlyPayment * 12;
      }

      // Annual income
      const annualRent = weeklyRent * 52;

      // Management fee
      const annualManagementFee = annualRent * managementFeePct;

      // Allowances
      const vacancyAllowance = weeklyRent * 2;
      const maintenanceAllowance = purchasePrice * 0.005;

      // Annual expenses
      const totalExpenses = annualLoanPayment + annualManagementFee + insurance + councilFees + vacancyAllowance + maintenanceAllowance;

      // Cash flow (interest-only basis)
      const annualCashFlow = annualRent - totalExpenses;
      const monthlyCashFlow = annualCashFlow / 12;

      // Yields
      const grossYield = purchasePrice > 0 ? (annualRent / purchasePrice) * 100 : 0;
      const netYield = purchasePrice > 0
        ? ((annualRent - totalExpenses) / purchasePrice) * 100
        : 0;

      // Startup expenses
      const totalUpfront = deposit + stampDuty + conveyancing;
      updateSharedUpfront(totalUpfront, getVal('interestRate'));

      // Update DOM — Start Up Expenses
      document.getElementById('resDeposit').textContent = formatCurrency(deposit);
      document.getElementById('resStampDuty').textContent = formatCurrency(stampDuty);
      document.getElementById('resConveyancing').textContent = formatCurrency(conveyancing);
      document.getElementById('resTotalUpfront').textContent = formatCurrency(totalUpfront);

      // Update DOM — Income
      document.getElementById('resWeeklyRent').textContent = formatCurrency(weeklyRent) + '/wk';
      document.getElementById('resAnnualRent').textContent = formatCurrency(annualRent) + '/yr';

      // Update DOM — Month-to-Month Picture
      const monthlyRent = annualRent / 12;
      const monthlyMgmt = annualManagementFee / 12;
      const monthlyLoan = annualLoanPayment / 12;
      const monthlyNet = monthlyRent - monthlyMgmt - monthlyLoan;
      document.getElementById('resMonthlyRent').textContent = formatCurrency(monthlyRent) + '/mo';
      document.getElementById('resMonthlyMgmt').textContent = '-' + formatCurrency(monthlyMgmt) + '/mo';
      document.getElementById('resMonthlyLoan').textContent = '-' + formatCurrency(monthlyLoan) + '/mo';
      const mCfEl = document.getElementById('resMonthlyCashFlow');
      mCfEl.textContent = formatCurrency(monthlyNet) + '/mo';
      mCfEl.className = 'line-value ' + (monthlyNet >= 0 ? 'positive' : 'negative');

      // Update DOM — Expenses
      document.getElementById('resLoanPayment').textContent = formatCurrency(annualLoanPayment) + '/yr';

      // Loan payment breakdown: interest vs principal (first year)
      const annualInterest = loanAmount * interestRate;
      const annualPrincipal = loanType === 'PI' ? annualLoanPayment - annualInterest : 0;
      document.getElementById('resInterestPortion').textContent = 'Interest: ' + formatCurrency(annualInterest);
      document.getElementById('resPrincipalPortion').textContent = 'Principal: ' + formatCurrency(annualPrincipal);
      document.getElementById('loanBreakdown').style.display = loanType === 'PI' ? 'flex' : 'none';

      document.getElementById('resManagement').textContent = formatCurrency(annualManagementFee) + '/yr';
      document.getElementById('resInsurance').textContent = formatCurrency(insurance) + '/yr';
      document.getElementById('resCouncil').textContent = formatCurrency(councilFees) + '/yr';
      document.getElementById('resVacancy').textContent = formatCurrency(vacancyAllowance) + '/yr';
      document.getElementById('resMaintenance').textContent = formatCurrency(maintenanceAllowance) + '/yr';
      document.getElementById('resTotalExpenses').textContent = formatCurrency(totalExpenses) + '/yr';

      // Tax Benefit
      const annualInterestOnly = loanAmount * interestRate;
      const deductibleExpenses = annualInterestOnly + annualManagementFee + insurance + councilFees + maintenanceAllowance;
      const netRentalPosition = annualRent - deductibleExpenses;
      const taxBenefit = netRentalPosition < 0 ? Math.abs(netRentalPosition) * 0.30 : 0;
      document.getElementById('resDeductible').textContent = formatCurrency(deductibleExpenses) + '/yr';
      const nrEl = document.getElementById('resNetRental');
      nrEl.textContent = formatCurrency(netRentalPosition) + '/yr';
      nrEl.className = 'line-value ' + (netRentalPosition >= 0 ? 'positive' : 'negative');
      const tbEl = document.getElementById('resTaxBenefit');
      tbEl.textContent = taxBenefit > 0 ? formatCurrency(taxBenefit) + '/yr' : '-';
      tbEl.className = 'line-value ' + (taxBenefit > 0 ? 'positive' : '');

      // Update DOM — Results
      const cashFlowEl = document.getElementById('annualCashFlow');
      cashFlowEl.textContent = formatCurrency(annualCashFlow) + '/yr';
      cashFlowEl.className = 'result-value ' + (annualCashFlow >= 0 ? 'positive' : 'negative');
      document.getElementById('monthlyCashFlow').textContent = formatCurrency(monthlyCashFlow) + '/month';

      document.getElementById('grossYield').textContent = grossYield.toFixed(2) + '%';

      const netYieldEl = document.getElementById('netYield');
      netYieldEl.textContent = netYield.toFixed(2) + '%';
      netYieldEl.className = 'result-value ' + (netYield >= 0 ? 'positive' : 'negative');

      const cashOnCash = totalUpfront > 0 ? (annualCashFlow / totalUpfront) * 100 : 0;
      const cocEl = document.getElementById('cashOnCash');
      cocEl.textContent = cashOnCash.toFixed(2) + '%';
      cocEl.className = 'result-value ' + (cashOnCash >= 0 ? 'positive' : 'negative');

      // Projections
      [5, 10].forEach(years => {
        const futureValue = purchasePrice * Math.pow(1 + expectedGrowth, years);
        const capitalGrowth = futureValue - purchasePrice;

        // Remaining loan balance
        let remainingLoan;
        if (loanType === 'IO') {
          remainingLoan = loanAmount;
        } else if (interestRate === 0) {
          remainingLoan = Math.max(0, loanAmount - (loanAmount / (loanTerm * 12)) * (years * 12));
        } else {
          const monthlyRate = interestRate / 12;
          const totalPayments = loanTerm * 12;
          const paymentsMade = Math.min(years * 12, totalPayments);
          remainingLoan = loanAmount * (Math.pow(1 + monthlyRate, totalPayments) - Math.pow(1 + monthlyRate, paymentsMade)) / (Math.pow(1 + monthlyRate, totalPayments) - 1);
          if (remainingLoan < 0) remainingLoan = 0;
        }

        const equity = futureValue - remainingLoan;

        // Projected rent grows with property value
        const futureWeeklyRent = weeklyRent * Math.pow(1 + expectedGrowth, years);
        const futureAnnualRent = futureWeeklyRent * 52;

        // Projected expenses (maintenance and vacancy scale with growth, loan payment stays fixed)
        const futureManagement = futureAnnualRent * managementFeePct;
        const futureVacancy = futureWeeklyRent * 2;
        const futureMaintenance = futureValue * 0.005;
        const futureExpenses = annualLoanPayment + futureManagement + insurance + councilFees + futureVacancy + futureMaintenance;
        const futureCashFlow = futureAnnualRent - futureExpenses;

        // Update DOM
        document.getElementById(`proj${years}Value`).textContent = formatCurrency(futureValue);
        document.getElementById(`proj${years}Growth`).textContent = formatCurrency(capitalGrowth);
        const principalPaid = loanAmount - remainingLoan;
        document.getElementById(`proj${years}Principal`).textContent = formatCurrency(principalPaid);
        document.getElementById(`proj${years}Loan`).textContent = formatCurrency(remainingLoan);
        document.getElementById(`proj${years}Equity`).textContent = formatCurrency(equity);
        document.getElementById(`proj${years}Rent`).textContent = formatCurrency(futureWeeklyRent) + '/wk';

        const cfEl = document.getElementById(`proj${years}CashFlow`);
        cfEl.textContent = formatCurrency(futureCashFlow) + '/yr';
        cfEl.className = 'line-value ' + (futureCashFlow >= 0 ? 'positive' : 'negative');

        // Cash Out Position
        const salePrice = futureValue;
        const salesCosts = salePrice * 0.03;
        const netProceeds = salePrice - salesCosts - remainingLoan;
        const costBase = purchasePrice + stampDuty + conveyancing + salesCosts;
        const capitalGain = salePrice - costBase;
        const discountedGain = capitalGain > 0 ? capitalGain * 0.50 : 0;
        const cgt = discountedGain * 0.30;
        const trueCashReturn = netProceeds - cgt;

        document.getElementById(`proj${years}Sale`).textContent = formatCurrency(salePrice);
        document.getElementById(`proj${years}SaleCosts`).textContent = formatCurrency(salesCosts);
        document.getElementById(`proj${years}LoanPayout`).textContent = formatCurrency(remainingLoan);
        document.getElementById(`proj${years}NetProceeds`).textContent = formatCurrency(netProceeds);
        document.getElementById(`proj${years}CGT`).textContent = '\u2248 ' + formatCurrency(cgt);

        const trEl = document.getElementById(`proj${years}TrueReturn`);
        trEl.textContent = formatCurrency(trueCashReturn);
        trEl.className = 'line-value ' + (trueCashReturn >= 0 ? 'positive' : 'negative');

        // Investment Performance
        let cumulativeCashFlow = 0;
        for (let y = 1; y <= years; y++) {
          const yRent = weeklyRent * Math.pow(1 + expectedGrowth, y) * 52;
          const yValue = purchasePrice * Math.pow(1 + expectedGrowth, y);
          const yMgmt = yRent * managementFeePct;
          const yVacancy = (weeklyRent * Math.pow(1 + expectedGrowth, y)) * 2;
          const yMaint = yValue * 0.005;
          const yExpenses = annualLoanPayment + yMgmt + insurance + councilFees + yVacancy + yMaint;
          cumulativeCashFlow += yRent - yExpenses;
        }

        const totalProfit = (trueCashReturn - totalUpfront) + cumulativeCashFlow;
        const returnOnCash = totalUpfront > 0 ? (totalProfit / totalUpfront) * 100 : 0;
        const annualisedReturn = totalUpfront > 0 ? (Math.pow(1 + totalProfit / totalUpfront, 1 / years) - 1) * 100 : 0;

        document.getElementById(`proj${years}CashInvested`).textContent = formatCurrency(totalUpfront);

        const cumCfEl = document.getElementById(`proj${years}CumCashFlow`);
        cumCfEl.textContent = formatCurrency(cumulativeCashFlow);

        const tpEl = document.getElementById(`proj${years}TotalProfit`);
        tpEl.textContent = formatCurrency(totalProfit);
        tpEl.className = 'line-value ' + (totalProfit >= 0 ? 'positive' : 'negative');

        const rocEl = document.getElementById(`proj${years}ReturnOnCash`);
        rocEl.textContent = returnOnCash.toFixed(2) + '%';
        rocEl.className = 'line-value ' + (returnOnCash >= 0 ? 'positive' : 'negative');

        const arEl = document.getElementById(`proj${years}AnnualisedReturn`);
        arEl.textContent = annualisedReturn.toFixed(2) + '%';
        arEl.className = 'line-value ' + (annualisedReturn >= 0 ? 'positive' : 'negative');
      });
    }

    inputs.forEach(input => input.addEventListener('input', calculate));
    stateSelect.addEventListener('change', calculate);

    // --- Offset Calculator ---

    const offsetLoanTypeSelect = document.getElementById('offsetLoanType');
    const offsetLoanTermGroup = document.getElementById('offsetLoanTermGroup');
    const usePropertyUpfront = document.getElementById('usePropertyUpfront');
    const usePropertyRate = document.getElementById('usePropertyRate');
    const offsetAmountInput = document.getElementById('offsetAmount');
    const offsetRateInput = document.getElementById('offsetInterestRate');

    // Show/hide offset loan term based on loan type
    offsetLoanTypeSelect.addEventListener('change', function() {
      offsetLoanTermGroup.style.display = this.value === 'PI' ? '' : 'none';
      calculateOffset();
    });

    // Toggle: Use Property Total Upfront
    usePropertyUpfront.addEventListener('change', function() {
      offsetAmountInput.disabled = this.checked;
      if (this.checked) {
        offsetAmountInput.value = Math.round(window.TrueReturn.totalUpfront);
      }
      calculateOffset();
    });

    // Toggle: Use Property Rate
    usePropertyRate.addEventListener('change', function() {
      offsetRateInput.disabled = this.checked;
      if (this.checked) {
        offsetRateInput.value = window.TrueReturn.interestRate;
      }
      calculateOffset();
    });

    // Wire offset inputs
    document.querySelectorAll('#tab-offset input[type="number"], #tab-offset select').forEach(el => {
      el.addEventListener('input', calculateOffset);
      el.addEventListener('change', calculateOffset);
    });

    function calculateOffset() {
      const offsetAmount = parseFloat(offsetAmountInput.value) || 0;
      const loanBalance = parseFloat(document.getElementById('offsetLoanBalance').value) || 0;
      const rate = (parseFloat(offsetRateInput.value) || 0) / 100;
      const loanType = offsetLoanTypeSelect.value;
      const loanTerm = parseFloat(document.getElementById('offsetLoanTerm').value) || 30;

      // Cap offset at loan balance
      const effectiveOffset = Math.min(offsetAmount, loanBalance);

      let noOffset5 = 0, noOffset10 = 0, withOffset5 = 0, withOffset10 = 0;
      let totalInterestNoOffset = 0, totalInterestWithOffset = 0;
      let monthsNoOffset = 0, monthsWithOffset = 0;
      const isPandI = loanType === 'PI' && rate > 0;

      if (!isPandI) {
        // Interest-only: simple calculation (loan never pays off)
        noOffset5 = loanBalance * rate * 5;
        noOffset10 = loanBalance * rate * 10;
        withOffset5 = (loanBalance - effectiveOffset) * rate * 5;
        withOffset10 = (loanBalance - effectiveOffset) * rate * 10;
        totalInterestNoOffset = loanBalance * rate * loanTerm;
        totalInterestWithOffset = (loanBalance - effectiveOffset) * rate * loanTerm;
        monthsNoOffset = 0;
        monthsWithOffset = 0;
      } else {
        // P&I: month-by-month amortisation over full loan term
        const monthlyRate = rate / 12;
        const numPayments = loanTerm * 12;

        if (monthlyRate > 0 && numPayments > 0) {
          const monthlyPayment = loanBalance * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1);

          // Without offset — full term
          let balance = loanBalance;
          for (let m = 1; m <= numPayments && balance > 0.01; m++) {
            const interest = balance * monthlyRate;
            const principal = Math.min(monthlyPayment - interest, balance);
            if (m <= 60) noOffset5 += interest;
            if (m <= 120) noOffset10 += interest;
            totalInterestNoOffset += interest;
            balance -= principal;
            monthsNoOffset = m;
          }

          // With offset — full term
          let balanceWithOffset = loanBalance;
          for (let m = 1; m <= numPayments && balanceWithOffset > 0.01; m++) {
            const effectiveBal = Math.max(0, balanceWithOffset - effectiveOffset);
            const interest = effectiveBal * monthlyRate;
            const principal = Math.min(monthlyPayment - interest, balanceWithOffset);
            if (m <= 60) withOffset5 += interest;
            if (m <= 120) withOffset10 += interest;
            totalInterestWithOffset += interest;
            balanceWithOffset -= principal;
            monthsWithOffset = m;
          }
        }
      }

      const saved5 = noOffset5 - withOffset5;
      const saved10 = noOffset10 - withOffset10;
      const savedLifetime = totalInterestNoOffset - totalInterestWithOffset;

      // Effective return = the interest rate (each dollar in offset saves you the rate, tax-free)
      const effectiveReturnPct = effectiveOffset > 0 ? rate * 100 : 0;

      // Time saved (P&I only)
      const timeSavedRow = document.getElementById('offsetTimeSavedRow');
      if (isPandI && monthsNoOffset > monthsWithOffset) {
        const savedMonths = monthsNoOffset - monthsWithOffset;
        const yrs = Math.floor(savedMonths / 12);
        const mos = savedMonths % 12;
        let timeStr = '';
        if (yrs > 0) timeStr += yrs + (yrs === 1 ? ' yr' : ' yrs');
        if (yrs > 0 && mos > 0) timeStr += ' ';
        if (mos > 0) timeStr += mos + (mos === 1 ? ' mo' : ' mos');
        if (!timeStr) timeStr = '-';
        document.getElementById('offsetTimeSaved').textContent = timeStr;
        timeSavedRow.style.display = '';
      } else {
        timeSavedRow.style.display = isPandI ? '' : 'none';
        document.getElementById('offsetTimeSaved').textContent = '-';
      }

      // Effective return (shown once)
      document.getElementById('offsetEffectiveReturn').textContent = effectiveReturnPct.toFixed(2) + '%';

      // 5 Year
      document.getElementById('offsetNoOffset5').textContent = formatCurrency(noOffset5);
      document.getElementById('offsetWithOffset5').textContent = formatCurrency(withOffset5);
      document.getElementById('offsetSaved5').textContent = formatCurrency(saved5);

      // 10 Year
      document.getElementById('offsetNoOffset10').textContent = formatCurrency(noOffset10);
      document.getElementById('offsetWithOffset10').textContent = formatCurrency(withOffset10);
      document.getElementById('offsetSaved10').textContent = formatCurrency(saved10);

      // Lifetime
      document.getElementById('offsetNoOffsetLife').textContent = formatCurrency(totalInterestNoOffset);
      document.getElementById('offsetWithOffsetLife').textContent = formatCurrency(totalInterestWithOffset);
      document.getElementById('offsetSavedLifetime').textContent = formatCurrency(savedLifetime);
    }

    // Set initial disabled state for synced inputs
    offsetAmountInput.disabled = usePropertyUpfront.checked;
    offsetRateInput.disabled = usePropertyRate.checked;

    // Run initial calculations
    calculate();
  </script>
</body>
</html>
